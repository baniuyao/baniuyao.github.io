<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>




  <meta name="keywords" content="Hexo,next" />



  <link rel="alternate" href="/atom.xml" title="Renjie Yao's Blog" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Renjie Yao's Blog">
<meta property="og:url" content="http://blog.yaorenjie.com/page/2/index.html">
<meta property="og:site_name" content="Renjie Yao's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Renjie Yao's Blog">
<meta name="twitter:description">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>

  <title> Renjie Yao's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  

  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?14c861085b24e8d70ed28c14d40e7cbc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Renjie Yao's Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            Tags
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/06/09/Build-Jasig-CAS-from-Zero-1-Build-CAS-Server/" itemprop="url">
                Build Jasig CAS from Zero (1)  - Build CAS Server
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-06-09T10:54:17+08:00" content="2016-06-09">
            2016-06-09
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2016/06/09/Build-Jasig-CAS-from-Zero-1-Build-CAS-Server/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/06/09/Build-Jasig-CAS-from-Zero-1-Build-CAS-Server/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="Download_source_tarball_from_github">Download source tarball from github</h1><p>You can get CAS from git easily:)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/apereo/cas.git</span></span><br><span class="line">git fetch</span><br><span class="line">git checkout <span class="number">4.2</span>.x</span><br></pre></td></tr></table></figure>
<p>The master branch is not a can-be-compiled version. I got failure information when I run compile commands in <code>master</code> branch:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$./dev-build-<span class="keyword">no</span>-tests.<span class="keyword">sh</span></span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with <span class="keyword">an</span> exception.</span><br><span class="line"></span><br><span class="line"><span class="comment">* Where:</span></span><br><span class="line">Build <span class="keyword">file</span> '/private/tmp/cas/cas-management-webapp/build.gradle' <span class="keyword">line</span>: 28</span><br><span class="line"></span><br><span class="line"><span class="comment">* What went wrong:</span></span><br><span class="line">A problem occurred evaluating project ':cas-management-webapp'.</span><br><span class="line">&gt; <span class="keyword">No</span> such property: java <span class="keyword">for</span> <span class="keyword">class</span>: org.gradle.api.java.archives.internal.DefaultManifest</span><br><span class="line"></span><br><span class="line"><span class="comment">* Try:</span></span><br><span class="line"><span class="keyword">Run</span> with --stacktrace option to get the <span class="keyword">stack</span> trace. <span class="keyword">Run</span> with --info or --debug option to get <span class="keyword">more</span> <span class="keyword">log</span> output.</span><br><span class="line"></span><br><span class="line">BUILD FAILED</span><br><span class="line"></span><br><span class="line"><span class="keyword">Total</span> time: 11.67 secs</span><br></pre></td></tr></table></figure>
<p>The stable version version in <a href="https://github.com/apereo/cas/releases" target="_blank" rel="external">cas release page</a> is 4.2.2. So just checkout out the stable version.</p>
<h1 id="compile">compile</h1><h2 id="get_gradle">get gradle</h2><p>CAS can be compiled by <code>gradle</code>, when you first run <code>gradlew</code>(gradle wrapper), the project will download gradle-XXX-bin.zip. If you already have it or you have some problems downloading it(such as GFW), you can simply edit `{CAS_PWD}/gradle/wrapper/gradle-wrapper.properties‚Äù like below:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="setting">distributionBase=<span class="value">GRADLE_USER_HOME</span></span></span><br><span class="line"><span class="setting">distributionPath=<span class="value">wrapper/dists</span></span></span><br><span class="line"><span class="setting">zipStoreBase=<span class="value">GRADLE_USER_HOME</span></span></span><br><span class="line"><span class="setting">zipStorePath=<span class="value">wrapper/dists</span></span></span><br><span class="line"><span class="setting">distributionUrl=<span class="value">https\://services.gradle.org/distributions/gradle-<span class="number">2.13</span>-all.zip</span></span></span><br></pre></td></tr></table></figure>
<p>Replace <code>distributionUrl</code> with your own url.</p>
<p>If you have local gradle zip file, use the zip file name directly and put zip file into <code>{CAS_PWD}/gradle/wrapper</code>. For example if my gradle zip file is <code>gradle-2.10-bin.zip</code>, you need parameter <code>distributionUrl</code> like this:</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">...</span><br><span class="line"></span>distributionUtl=gradle-2.10-bin.zip</span><br></pre></td></tr></table></figure>
<h2 id="compile_cas_project">compile cas project</h2><p>There is two bootstrap shell in cas directory, <code>dev-build.sh</code> and <code>dev-build-no-tests.sh</code>. The difference between them is obviously shown in their names - <code>dev-build-no-tests.sh</code> will set this flag <code>-DskipAspectJ=true</code></p>
<p>When you run <code>dev-build.sh</code> or <code>dev-build-no-tests.sh</code> for a couple of minutes, you will probably get this conflicts failure.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">:cas-server-support-pac4j</span><span class="symbol">:compileAspect</span></span><br><span class="line"><span class="constant">Download </span>...</span><br><span class="line">&gt; <span class="symbol">:cas-server-support-pac4j</span><span class="symbol">:compileAspecFAILED</span></span><br><span class="line"></span><br><span class="line"><span class="constant">FAILURE:</span> <span class="constant">Build </span>failed with an exception.</span><br><span class="line"></span><br><span class="line">* <span class="constant">What </span>went <span class="symbol">wrong:</span></span><br><span class="line"><span class="constant">Execution </span>failed <span class="keyword">for</span> task <span class="string">':cas-server-support-pac4j:compileAspect'</span>.</span><br><span class="line">&gt; <span class="constant">Could </span><span class="keyword">not</span> resolve all dependencies <span class="keyword">for</span> configuration <span class="string">':cas-server-support-pac4j:compile'</span>.</span><br><span class="line">   &gt; <span class="constant">A </span>conflict was found between the following <span class="symbol">modules:</span></span><br><span class="line">      - commons-<span class="symbol">io:</span>commons-<span class="symbol">io:</span><span class="number">2.4</span></span><br><span class="line">      - commons-<span class="symbol">io:</span>commons-<span class="symbol">io:</span><span class="number">2.5</span></span><br><span class="line"></span><br><span class="line">* <span class="constant">Try:</span></span><br><span class="line"><span class="constant">Run </span>with --stacktrace option to get the stack trace. <span class="constant">Run </span>with --info <span class="keyword">or</span> --debug option to get more log output.</span><br><span class="line"></span><br><span class="line"><span class="constant">BUILD FAILED</span></span><br><span class="line"></span><br><span class="line"><span class="constant">Total </span><span class="symbol">time:</span> <span class="number">10</span> mins <span class="number">48.643</span> secs</span><br></pre></td></tr></table></figure>
<p>It is casuse by the conflict between <code>commons-io:2.4</code> and <code>commons-io:2.5</code> in <code>cas-server-support-pac4j</code>, we need to add <code>-DskipVersionConflict=true</code> in bootstrap scripts.</p>
<p>If you build it in IntelliJ IDEA, set this parameter in <code>Preferences-Build,Execution,Deployment-Build Tools-Gradle-Gradle VM options</code>.</p>
<p>Plus, if you want to use http proxy in gradle, you need to set these parameters:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-DproxySet=<span class="literal">true</span> -DproxyHost=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -DproxyPort=<span class="number">8123</span></span><br></pre></td></tr></table></figure>
<h2 id="For_IDE">For IDE</h2><p>We need to execute extra command for IDE</p>
<h3 id="IDEA">IDEA</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew idea</span><br></pre></td></tr></table></figure>
<h3 id="Eclipse">Eclipse</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew eclipse</span><br></pre></td></tr></table></figure>
<h1 id="To_Be_Contined‚Ä¶w">To Be Contined‚Ä¶w</h1></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/05/19/Awesome-dataviz/" itemprop="url">
                Awesome dataviz
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-05-19T10:42:15+08:00" content="2016-05-19">
            2016-05-19
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2016/05/19/Awesome-dataviz/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/05/19/Awesome-dataviz/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>From <a href="https://github.com/fasouto/awesome-dataviz" target="_blank" rel="external">fasouto github</a></p>
<h1 id="Awesome_dataviz">Awesome dataviz <a href="https://github.com/sindresorhus/awesome" target="_blank" rel="external"><img src="https://cdn.rawgit.com/sindresorhus/awesome/d7305f38d29fed78fa85652e3a63e154dd8e8829/media/badge.svg" alt="Awesome"></a></h1><p>A curated list of awesome data visualizations frameworks, libraries and software. Inspired by <a href="https://github.com/vinta/awesome-python" target="_blank" rel="external">awesome-python</a>.</p>
<h2 id="Table_of_contents">Table of contents</h2><ul>
<li><a href="#awesome-dataviz">Awesome dataviz</a><ul>
<li><a href="#javascript-tools">JavaScript tools</a><ul>
<li><a href="#charting-libraries">Charting libraries</a></li>
<li><a href="#charting-libraries-for-graphs">Charting libraries for graphs</a></li>
<li><a href="#maps">Maps</a></li>
<li><a href="#d3">d3</a></li>
<li><a href="#dcjs">dc.js</a></li>
<li><a href="#misc">Misc</a></li>
</ul>
</li>
<li><a href="#android-tools">Android tools</a></li>
<li><a href="#c-tools">C++ tools</a></li>
<li><a href="#golang-tools">Golang tools</a></li>
<li><a href="#ios-tools">iOS tools</a></li>
<li><a href="#python-tools">Python tools</a></li>
<li><a href="#r-tools">R tools</a></li>
<li><a href="#ruby-tools">Ruby tools</a></li>
<li><a href="#other-tools">Other tools</a></li>
</ul>
</li>
<li><a href="#resources">Resources</a><ul>
<li><a href="#books">Books</a></li>
<li><a href="#twitter-accounts">Twitter accounts</a></li>
<li><a href="#websites">Websites</a></li>
</ul>
</li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2 id="JavaScript_tools">JavaScript tools</h2><h3 id="Charting_libraries">Charting libraries</h3><ul>
<li><a href="http://c3js.org/" target="_blank" rel="external">C3</a> - a D3-based reusable chart library.</li>
<li><a href="http://www.chartjs.org/" target="_blank" rel="external">Chart.js</a> - Charts with the canvas tag.</li>
<li><a href="http://gionkunz.github.io/chartist-js/" target="_blank" rel="external">Chartist.js</a> - Responsive charts with great browser compatibility.</li>
<li><a href="http://dimplejs.org/" target="_blank" rel="external">Dimple</a> - An object-oriented API for business analytics.</li>
<li><a href="http://dygraphs.com/" target="_blank" rel="external">Dygraphs</a> - Interactive line charts library that works with huge datasets.</li>
<li><a href="https://github.com/ecomfe/echarts" target="_blank" rel="external">Echarts</a> - Highly customizable and interactive charts ready for big datasets.</li>
<li><a href="https://github.com/epochjs/epoch" target="_blank" rel="external">Epoch</a> - Perfect to create real-time charts.</li>
<li><a href="https://github.com/highcharts/highcharts" target="_blank" rel="external">Highcharts</a> - A charting library based on SVG and VML rendering. Free (<a href="http://creativecommons.org/licenses/by-nc/3.0/" target="_blank" rel="external">CC BY-NC</a> for non-profit projects.</li>
<li><a href="http://metricsgraphicsjs.org/" target="_blank" rel="external">MetricsGraphics.js</a> - Optimized for time-series data.</li>
<li><a href="http://morrisjs.github.io/morris.js/" target="_blank" rel="external">Morris.js</a> - Pretty time-series line graphs.</li>
<li><a href="https://github.com/novus/nvd3" target="_blank" rel="external">NVD3</a> - A reusable charting library written in d3.js.</li>
<li><a href="https://github.com/benpickles/peity" target="_blank" rel="external">Peity</a> - Create small inline svg charts.</li>
<li><a href="https://github.com/plotly/plotly.js/" target="_blank" rel="external">Plotly.js</a> - Powerful declarative library with support for 20 chart types.</li>
<li><a href="http://techanjs.org/" target="_blank" rel="external">TechanJS</a> - Stock and financial charts.</li>
</ul>
<h3 id="Charting_libraries_for_graphs">Charting libraries for graphs</h3><ul>
<li><a href="http://marvl.infotech.monash.edu/webcola/" target="_blank" rel="external">Cola.js</a> - A tool to create diagrams using constraint-based optimization techniques. Works with d3 and svg.js.</li>
<li><a href="http://js.cytoscape.org/" target="_blank" rel="external">Cytoscape.js</a> - JavaScript library for graph drawing maintained by <a href="http://www.cytoscape.org" target="_blank" rel="external">Cytoscape</a> core developers.</li>
<li><a href="https://github.com/Linkurious/linkurious.js/" target="_blank" rel="external">Linkurious</a> - A toolkit to speed up the development of graph visualization and interaction applications. Based on Sigma.js.</li>
<li><a href="http://sigmajs.org/" target="_blank" rel="external">Sigma.js</a> - JavaScript library dedicated to graph drawing.</li>
<li><a href="https://github.com/anvaka/VivaGraphJS" target="_blank" rel="external">VivaGraph</a> - Graph drawing library for JavaScript.</li>
</ul>
<h3 id="Maps">Maps</h3><ul>
<li><a href="https://github.com/CartoDB/cartodb" target="_blank" rel="external">CartoDB</a> - CartoDB is an open source tool that allows for the storage and visualization of geospatial data on the web.</li>
<li><a href="https://github.com/AnalyticalGraphicsInc/cesium" target="_blank" rel="external">Cesium</a> - WebGL virtual globe and map engine.</li>
<li><a href="http://leafletjs.com" target="_blank" rel="external">Leaflet</a> - JavaScript library for mobile-friendly interactive maps.</li>
<li><a href="https://github.com/humangeo/leaflet-dvf" target="_blank" rel="external">Leaflet Data Visualization Framework</a>  - A framework designed to simplify data visualization and thematic mapping using Leaflet.</li>
<li><a href="https://github.com/neveldo/jQuery-Mapael" target="_blank" rel="external">Mapael</a> - jQuery plugin based on the.js to display vector maps.</li>
<li><a href="http://mapsense.github.io/mapsense.js/" target="_blank" rel="external">Mapsense.js</a> - Combines d3.js with tile maps.</li>
<li><a href="http://modestmaps.com/" target="_blank" rel="external">Modest Maps</a> - BSD-licensed display and interaction library for tile-based maps in Javascript.</li>
</ul>
<h3 id="d3">d3</h3><ul>
<li>See <a href="https://github.com/wbkd/awesome-d3" target="_blank" rel="external">Awesome D3</a>.</li>
</ul>
<h3 id="dc-js">dc.js</h3><p><a href="https://github.com/dc-js/dc.js" target="_blank" rel="external">dc.js</a> is an multi-Dimensional charting built to work natively with crossfilter.</p>
<ul>
<li><a href="https://github.com/TomNeyland/angular-dc" target="_blank" rel="external">angular-dc</a> - AngularJS directives for dc.js.</li>
<li><a href="https://github.com/yurukov/dc.leaflet.js" target="_blank" rel="external">dc.leaflet.js</a> - dc.js charts using Leaflet maps.</li>
<li><a href="https://github.com/andrewreedy/ember-dc" target="_blank" rel="external">ember-dc</a> - Ember Component Wrappers for dc.js.</li>
</ul>
<h3 id="Misc">Misc</h3><ul>
<li><a href="http://gka.github.io/chroma.js/" target="_blank" rel="external">Chroma.js</a> - A small library for color manipulation.</li>
<li><a href="https://github.com/lipka/piecon" target="_blank" rel="external">Piecon</a> - Pie charts in your favicon.</li>
<li><a href="http://okfnlabs.org/recline/" target="_blank" rel="external">Recline.js</a> - Simple but powerful library for building data applications in pure JavaScript and HTML.</li>
<li><a href="http://riccardoscalco.github.io/textures/" target="_blank" rel="external">Textures.js</a> - A library to create SVG patterns.</li>
<li><a href="http://timeline.knightlab.com/" target="_blank" rel="external">Timeline.js</a> -  Create interactive timelines.</li>
<li><a href="http://vega.github.io/vega/" target="_blank" rel="external">Vega</a> - Vega is a visualization grammar, a declarative format for creating, saving, and sharing interactive visualization designs.</li>
<li><a href="http://visjs.org/" target="_blank" rel="external">Vis.js</a> - A dynamic visualization library including timeline, networks and graphs (2D and 3D).</li>
</ul>
<h2 id="Android_tools">Android tools</h2><ul>
<li><a href="https://github.com/lecho/hellocharts-android" target="_blank" rel="external">HelloCharts</a> - Charting library for Android compatible with API 8+.</li>
<li><a href="https://github.com/PhilJay/MPAndroidChart" target="_blank" rel="external">MPAndroidChart</a> - A powerful &amp; easy to use chart library.</li>
</ul>
<h2 id="C++_tools">C++ tools</h2><ul>
<li><a href="https://gitlab.kitware.com/vtk/vtk/blob/master/README.md" target="_blank" rel="external">Visualization Toolkit (VTK)</a> - open-source library for 3d Graphics, image processing and visualization.</li>
</ul>
<h2 id="Golang_tools">Golang tools</h2><ul>
<li><a href="https://github.com/vdobler/chart" target="_blank" rel="external">Charts for Go</a> - Basic charts in Go. Can render to ASCII, SVG and images.</li>
<li><a href="https://github.com/ajstarks/svgo" target="_blank" rel="external">svgo</a> - Go Language Library for SVG generation.</li>
</ul>
<h2 id="iOS_tools">iOS tools</h2><ul>
<li><a href="https://github.com/Jawbone/JBChartView" target="_blank" rel="external">JBChartView</a> - Charting library for both line and bar graphs.</li>
<li><a href="https://github.com/kevinzhow/PNChart" target="_blank" rel="external">PNChart</a> - A simple and beautiful chart lib used in Piner and CoinsMan.</li>
<li><a href="https://github.com/danielgindi/ios-charts" target="_blank" rel="external">ios-charts</a> -  iOS port of MPAndroidChart. You can create charts for both platforms with very similar code.</li>
</ul>
<h2 id="Python_tools">Python tools</h2><ul>
<li><a href="http://bokeh.pydata.org/en/latest/" target="_blank" rel="external">bokeh</a> - Interactive Web Plotting for Python.</li>
<li><a href="https://github.com/yhat/ggplot" target="_blank" rel="external">ggplot</a> - Same API as ggplot2 for R.</li>
<li><a href="https://github.com/glumpy/glumpy" target="_blank" rel="external">glumpy</a> - OpenGL scientific visualizations library.</li>
<li><a href="http://matplotlib.org/" target="_blank" rel="external">matplotlib</a> - 2D plotting library.</li>
<li><a href="http://www.pygal.org/en/latest/" target="_blank" rel="external">pygal</a> - A dynamic SVG charting library.</li>
<li><a href="http://www.pyqtgraph.org/" target="_blank" rel="external">PyQtGraph</a> - Interactive and realtime 2D/3D/Image plotting and science/engineering widgets.</li>
<li><a href="http://stanford.edu/~mwaskom/software/seaborn/" target="_blank" rel="external">seaborn</a> - A library for making attractive and informative statistical graphics.</li>
<li><a href="http://toyplot.readthedocs.org/en/stable/" target="_blank" rel="external">toyplot</a> - The kid-sized plotting toolkit for Python with grownup-sized goals.</li>
<li><a href="https://github.com/wrobstory/vincent" target="_blank" rel="external">Vincent</a> - A Python to Vega translator.</li>
<li><a href="http://vispy.org/" target="_blank" rel="external">VisPy</a> - High-performance scientific visualization based on OpenGL.</li>
<li><a href="https://github.com/mpld3/mpld3" target="_blank" rel="external">mpld3</a> - D3 Renderings of Matplotlib Graphics</li>
</ul>
<h2 id="R_tools">R tools</h2><ul>
<li><a href="http://ggplot2.org/" target="_blank" rel="external">ggplot2</a> - A plotting system based on the grammar of graphics.</li>
<li><a href="http://lattice.r-forge.r-project.org" target="_blank" rel="external">lattice</a> - trellis graphics for R</li>
<li><a href="https://github.com/ropensci/plotly" target="_blank" rel="external">plotly</a> - Interactive charts (including adding interactivity to ggplot2 output), cartograms and simple network diagrams</li>
<li><a href="http://hafen.github.io/rbokeh/" target="_blank" rel="external">rbokeh</a> - R Interface to Bokeh.</li>
<li><a href="https://cran.r-project.org/web/packages/rgl/index.html" target="_blank" rel="external">rgl</a> - 3D Visualization Using OpenGL</li>
<li><a href="http://shiny.rstudio.com" target="_blank" rel="external">shiny</a> - Framework for creating interactive applications/visualisations</li>
<li><a href="http://dataknowledge.github.io/visNetwork/" target="_blank" rel="external">visNetwork</a> - Interactive network visualisations</li>
</ul>
<h2 id="Ruby_tools">Ruby tools</h2><ul>
<li><a href="https://github.com/ankane/chartkick" target="_blank" rel="external">Chartkick</a> - Create charts with one line of Ruby.</li>
</ul>
<h2 id="Other_tools">Other tools</h2><p>Tools that are not tied to a particular platform or language.</p>
<ul>
<li><a href="https://github.com/mikesall/charted" target="_blank" rel="external">Charted</a> - A charting tool that produces automatic, shareable charts from any data file.</li>
<li><a href="https://github.com/gephi/gephi" target="_blank" rel="external">Gephi</a> - An open-source platform for visualizing and manipulating large graphs</li>
<li><a href="http://lightning-viz.org/" target="_blank" rel="external">Lightning</a> - A data-visualization server providing API-based access to reproducible, web-based, interactive visualizations.</li>
<li><a href="http://raw.densitydesign.org/" target="_blank" rel="external">RAW</a> - Create web visualizations from CSV or Excel files.</li>
<li><a href="https://github.com/holman/spark" target="_blank" rel="external">Spark</a> - Sparklines for the shell. It have several <a href="https://github.com/holman/spark/wiki/Alternative-Implementations" target="_blank" rel="external">implementations in different languages</a>.</li>
<li><a href="https://www.periscopedata.com/" target="_blank" rel="external">Periscope</a> - Create charts directly from SQL queries.</li>
</ul>
<h1 id="Resources">Resources</h1><h2 id="Books">Books</h2><ul>
<li><a href="http://www.amazon.com/Design-Information-Introduction-Histories-Visualizations/dp/1592538061" target="_blank" rel="external">Design for Information</a> by Isabel Meirelles.</li>
<li><a href="http://www.amazon.com/The-Best-American-Infographics-2014/dp/0547974515" target="_blank" rel="external">The Best American Infographics 2014</a> by Gareth Cook.</li>
<li><a href="http://www.amazon.com/The-Visual-Display-Quantitative-Information/dp/0961392142" target="_blank" rel="external">The Visual Display of Quantitative Information</a> by Edward Tufte.</li>
<li><a href="http://www.amazon.com/Street-Journal-Guide-Information-Graphics/dp/0393347281" target="_blank" rel="external">The Wall Street Journal Guide to Information Graphics</a> by Dona M. Wong</li>
<li><a href="http://www.amazon.com/Visualization-Analysis-Design-Peters-Series/dp/1466508914" target="_blank" rel="external">Visualization Analysis and Design</a> by Tamara Munzner.</li>
</ul>
<h2 id="Twitter_accounts">Twitter accounts</h2><ul>
<li><a href="https://twitter.com/albertocairo" target="_blank" rel="external">Alberto Cairo</a></li>
<li><a href="https://twitter.com/datavis" target="_blank" rel="external">Benjamin Wiederkehr</a></li>
<li><a href="https://twitter.com/mbostock" target="_blank" rel="external">Mike Bostock</a></li>
<li><a href="https://twitter.com/NadiehBremer" target="_blank" rel="external">Nadieh Bremer</a></li>
<li><a href="https://twitter.com/nytgraphics" target="_blank" rel="external">NYT Graphics</a></li>
<li><a href="https://twitter.com/VisualizingOrg" target="_blank" rel="external">Visualizing</a></li>
</ul>
<h2 id="Websites">Websites</h2><ul>
<li><a href="http://flowingdata.com/" target="_blank" rel="external">FlowingData</a></li>
<li><a href="http://www.informationisbeautiful.net/" target="_blank" rel="external">Information is Beautiful</a></li>
<li><a href="http://www.datavizcatalogue.com/" target="_blank" rel="external">The Data Visualization Catalogue</a> - A collection of data visualization methods, with pros and cons.</li>
<li><a href="http://www.visualcomplexity.com/vc/" target="_blank" rel="external">Visual Complexity</a> - A site about the visualization of complex networks.</li>
</ul>
<h1 id="Contributing">Contributing</h1><ul>
<li>Please check for duplicates first.</li>
<li>Keep descriptions short, simple and unbiased.</li>
<li>Please make an individual commit for each suggestion</li>
<li>Add a new category if needed.</li>
</ul>
<p>Thanks for your suggestions!</p>
<h1 id="License">License</h1><p><a href="http://creativecommons.org/publicdomain/zero/1.0/" target="_blank" rel="external"><img src="https://licensebuttons.net/p/zero/1.0/88x31.png" alt="CC0"></a></p>
<p>To the extent possible under law, <a href="http://fabiosouto.me/" target="_blank" rel="external">Fabio Souto</a> has waived all copyright and related or neighboring rights to this work.</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/12/09/Tricks-on-Crontab/" itemprop="url">
                Tricks on Crontab
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2015-12-09T18:01:40+08:00" content="2015-12-09">
            2015-12-09
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/12/09/Tricks-on-Crontab/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/12/09/Tricks-on-Crontab/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="‚Äò@‚Äô_in_Crontab">‚Äò@‚Äô in Crontab</h1><p>‚Äò@‚Äô sysmbol is available in crontab and it very useful especially for <code>@reboot</code>. <code>@reboot</code> makes it possible to run a script while machine starts.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@reboot     -   This runs the Cron job when the machine is started up or <span class="keyword">if</span> the Cron daemon is restarted</span><br><span class="line"></span><br><span class="line">@midnight   -   This runs the Cron job once a day at midnight, it<span class="string">'s the equivalent of 0 0 * * *</span><br><span class="line"></span><br><span class="line">@daily      -   Does exactly the same as @midnight</span><br><span class="line"></span><br><span class="line">@weekly     -   This runs a Cron job once a week on a Sunday the equivalent of 0 0 * * 0</span><br><span class="line"></span><br><span class="line">@monthly    -   This runs a Cron job once a month on the first day of every month at midnight and is the same as 0 0 1 * *</span><br><span class="line"></span><br><span class="line">@annually   -   Runs a Cron job once a year at midnight on the first day of the first month and is the equivalent of 0 0  1 1 *</span><br><span class="line"></span><br><span class="line">@yearly     -   The same as annually</span></span><br></pre></td></tr></table></figure>
<p>An example for run a command when the machine starts:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot date &gt;&gt; /tmp/date.log</span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/12/08/Python-smtplib-to-sendmail-with-STARTTLS-and-UTF8/" itemprop="url">
                Python smtplib to sendmail with STARTTL and UTF8
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2015-12-08T09:39:21+08:00" content="2015-12-08">
            2015-12-08
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/12/08/Python-smtplib-to-sendmail-with-STARTTLS-and-UTF8/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/12/08/Python-smtplib-to-sendmail-with-STARTTLS-and-UTF8/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="Intro">Intro</h1><p><code>Python</code> is a very powerful and useful tool in our daily work especially for DevOps. Sending mail is also a very simple need. I‚Äôve wrote serveral scripts for sending mail because I could not find the scripts I made before. This time I wanna get the things done - made is open on Github with GPLv3.</p>
<h1 id="Code">Code</h1><p>Project address is here: <a href="https://github.com/baniuyao/python-sendmail%20A" target="_blank" rel="external">python-sendmail on Github</a>.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This program is free software; you can redistribute it and/or modify</span></span><br><span class="line"><span class="comment"># it under the terms of the GNU General Public License as published by</span></span><br><span class="line"><span class="comment"># the Free Software Foundation; either version 3 of the License, or</span></span><br><span class="line"><span class="comment"># (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> smtplib, sys</span><br><span class="line"><span class="keyword">from</span> email.MIMEText <span class="keyword">import</span> MIMEText</span><br><span class="line"></span><br><span class="line"><span class="comment"># you can change this constant to parameters of sendmail</span></span><br><span class="line">USR_FROM = <span class="string">'me@yaorenjie.com'</span></span><br><span class="line">USR = <span class="string">'me'</span></span><br><span class="line">PASSWD = <span class="string">'HELLO_WORLD'</span></span><br><span class="line"></span><br><span class="line">SMTP_SERVER = <span class="string">'email.yaorenjie.com'</span></span><br><span class="line">SMTP_PORT = <span class="number">587</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendmail</span><span class="params">(usr_to, subject, msg, subtype=<span class="string">'html'</span>)</span>:</span></span><br><span class="line">    usr_from = USR_FROM</span><br><span class="line">    msg = MIMEText(msg, subtype, _charset=<span class="string">'utf-8'</span>)</span><br><span class="line">    msg[<span class="string">'Subject'</span>] = subject</span><br><span class="line">    msg[<span class="string">'To'</span>] = <span class="string">';'</span>.join(usr_to)</span><br><span class="line">    msg[<span class="string">'From'</span>] = usr_from</span><br><span class="line">    server = smtplib.SMTP()</span><br><span class="line">    server.connect(SMTP_SERVER, SMTP_PORT)</span><br><span class="line">    <span class="comment"># ONLY for debug</span></span><br><span class="line">    <span class="comment"># server.set_debuglevel(1)</span></span><br><span class="line">    <span class="comment"># if exchange use STARTTLS auth, you need to uncomment next line</span></span><br><span class="line">    <span class="comment"># server.starttls()</span></span><br><span class="line">    server.login(USR, PASSWD)</span><br><span class="line">    server.sendmail(usr_from, usr_to, msg.as_string())</span><br><span class="line">    server.quit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="string">"""</span><br><span class="line">    Example:</span><br><span class="line">    python sendmail.py --usr_to mike@mail.com peter@mail.com --subject 'TEST_SUBJECT' --msg 'TEST_MSG'</span><br><span class="line"></span><br><span class="line">    Remark:</span><br><span class="line">    1. msg supports HTML and Chinese</span><br><span class="line">    """</span></span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'parser for senemail'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--usr_to'</span>, dest=<span class="string">'usr_to'</span>, nargs=<span class="string">'+'</span>, required=<span class="keyword">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--subject'</span>, dest=<span class="string">'subject'</span>, required=<span class="keyword">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--msg'</span>, dest=<span class="string">'msg'</span>, required=<span class="keyword">True</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    sendmail(usr_to=args.usr_to, subject=args.subject, msg=args.msg)</span><br></pre></td></tr></table></figure></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/20/Covert-SOCKS5-Proxy-to-HTTP-Proxy-on-Mac/" itemprop="url">
                Convert SOCKS5 Proxy to HTTP Proxy on Mac
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2015-10-20T17:30:12+08:00" content="2015-10-20">
            2015-10-20
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/10/20/Covert-SOCKS5-Proxy-to-HTTP-Proxy-on-Mac/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/10/20/Covert-SOCKS5-Proxy-to-HTTP-Proxy-on-Mac/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>We usually use ShadowsocksX on Mac to build a SOCKS5 tunnel. But as a developer, I need HTTP Proxy in many places such as npm or some IDE tools. I need a tool to build a HTTP Proxy and pack data stream to SOCKS5 tunnel.</p>
<p>I found a solution of using a tool called <code>polipo</code>. We can simply install this tool by <code>homebrew</code>.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew instasll polipo</span><br></pre></td></tr></table></figure>
<p>After installed <code>polipo</code>, let‚Äôs make it work by a simple command.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">polipo socksParentProxy=localhost:1080</span><br></pre></td></tr></table></figure>
<p><code>localhost:1080</code> is your local SOCKS5 address. In default, HTTP proxy created by <code>polipo</code> is running on <code>localhost:8123</code>.</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/27/Advanced-Python-Data-Structure/" itemprop="url">
                Advanced Python Data Structure
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2015-08-27T15:13:37+08:00" content="2015-08-27">
            2015-08-27
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/08/27/Advanced-Python-Data-Structure/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/08/27/Advanced-Python-Data-Structure/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="Colletions">Colletions</h1><p><code>Collections</code> is a very useful data structure colletion in Python. In this post, I will introduct</p>
<h2 id="collections-Couter()">collections.Couter()</h2><p><code>Counter</code> is used to count something of iterable data structure such as list and tuple. Let‚Äôs see example below:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">name_list = [<span class="string">'frank'</span>, <span class="string">'frank'</span>, <span class="string">'tony'</span>, <span class="string">'jack'</span>, <span class="string">'judy'</span>, <span class="string">'jack'</span>, <span class="string">'jack'</span>]</span><br><span class="line">name_counter = Counter(name_list) </span><br><span class="line"><span class="keyword">print</span> counter <span class="comment"># print couter of name_list</span></span><br><span class="line"><span class="comment"># Counter(&#123;'jack': 3, 'frank': 2, 'tony': 1, 'judy': 1&#125;)</span></span><br><span class="line"><span class="keyword">print</span> counter.most_common(<span class="number">1</span>) <span class="comment"># print top 1 count</span></span><br><span class="line"><span class="comment"># [('jack', 3)]</span></span><br><span class="line"><span class="keyword">print</span> counter.most_common(<span class="number">2</span>) <span class="comment"># print top 2 count</span></span><br><span class="line"><span class="comment"># [('jack', 3), ('frank', 2)]</span></span><br></pre></td></tr></table></figure></p>
<p>Now I am going to update a Counter:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">name_list_one = [<span class="string">'frank'</span>, <span class="string">'frank'</span>, <span class="string">'tony'</span>]</span><br><span class="line">name_counter = Counter(name_list_one)</span><br><span class="line"><span class="comment"># name_counter: Counter(&#123;'frank': 2, 'tony': 1&#125;)</span></span><br><span class="line">name_list_two = [<span class="string">'tony'</span>, <span class="string">'jack'</span>]</span><br><span class="line">name_counter.update(name_list_two)</span><br><span class="line"><span class="comment"># name_counter: Counter(&#123;'tony': 2, 'frank': 2, 'jack': 1&#125;)</span></span><br><span class="line">name_counter.subtract([<span class="string">'frank'</span>]) <span class="comment"># subtract is the reverse operation of update</span></span><br><span class="line"><span class="comment"># name_counter: Counter(&#123;'tony': 2, 'frank': 1, 'jack': 1&#125;)</span></span><br><span class="line">name_counter.subtract([<span class="string">'jack'</span>, <span class="string">'jack'</span>]) <span class="comment"># value can be zero and negative counts</span></span><br><span class="line"><span class="comment"># name_counter: Counter(&#123;'tony': 2, 'frank': 1, 'jack': -1&#125;)</span></span><br></pre></td></tr></table></figure></p>
<h2 id="collections-defaultdict()">collections.defaultdict()</h2><p><code>defaultdict</code> is almost the same as <code>dict</code> which can be assigned by this statement:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">'name'</span>: <span class="string">'frank'</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>defaultdict</code> provides a function which will be invoked when we use a non-exists key to access the value in the <code>defaultdict</code>. When we want to get the value by a key which does not exist in the dict, <code>dict</code> will raise a <code>KeyError</code> Exception. We can use <code>d.get(KEY, DEFAULT_VALUE)</code> to define the value we will get if the key does not exist. It is okay but not an easy work-around. For example, I have a dict named <code>writer_book_dict</code> and its key is writers‚Äô name and value is books‚Äô name. When I get the value by a non-exist writer, it should return ‚ÄòNO BOOKS‚Äô. Let‚Äôs see how we can deal it with <code>dict</code> and <code>defaultdict</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">writer_book_dict = &#123;<span class="string">'frank'</span>: <span class="string">'book_1'</span>, <span class="string">'tony'</span>: <span class="string">'book_2'</span>&#125;</span><br><span class="line">book_by_jack = writer_book_dict.get(<span class="string">'jack'</span>, <span class="string">'NO BOOKS'</span>)</span><br><span class="line">book_by_jack = writer_book_dict.get(<span class="string">'judy'</span>, <span class="string">'NO BOOKS'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">writer_book_defaultdict = default(lamda: <span class="string">'NO BOOKS'</span>)</span><br><span class="line">writer_book_defaultdict.get(<span class="string">'jack'</span>) <span class="comment"># return 'NO BOOKS'</span></span><br></pre></td></tr></table></figure>
<p>We can use a complex function in initialize the defaultdict. Furthermore, we can also define the data structure of the value in the <code>defaultdict</code>. Let‚Äôs see an example, we need to make a classification of a short paragraph by the first letter of each world. It is to say, ‚ÄòI am a student and I like sports‚Äô -&gt; <code>{&#39;a&#39;: [&#39;am&#39;, &#39;a&#39;, &#39;and&#39;], &#39;i&#39;: [&#39;it&#39;, &#39;is&#39;, &#39;i&#39;], &#39;l&#39;: [&#39;like&#39;], &#39;s&#39;: [&#39;student&#39;, &#39;sports&#39;]}</code>. If we use <code>default</code> we must judge if the key exists and if it does not exist, we need to initialize with an empty list like below:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">paragraph = <span class="string">'I am a student and I like sports'</span></span><br><span class="line">word_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> paragraph:</span><br><span class="line">    first_letter = word[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> word_dict:</span><br><span class="line">        word_dict[first_letter] = [word]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        word_dict[first_letter].append(word)</span><br></pre></td></tr></table></figure></p>
<p>Let‚Äôs see how <code>defaultdict</code> works:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">paragraph = <span class="string">'I am a student and I like sports'</span></span><br><span class="line">word_defaultdict = defaultdict(list)</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> paragraph:</span><br><span class="line">    word_defaultdict[word[<span class="number">0</span>]].append(word)</span><br></pre></td></tr></table></figure></p>
<p>If we want to <code>uniq</code> the element of <code>word_defaultdict</code>, we can simply initialize <code>word_defaultdict</code> by <code>defaultdict(set)</code>.</p>
<h2 id="bisect">bisect</h2><p><code>bisect</code> is used to insert element into an sorted list and keep the list sorted. <code>bisect</code> module have six methods:</p>
<ol>
<li>bisect</li>
<li>bisect_left</li>
<li>bisect_right</li>
<li>insort</li>
<li>insort_left</li>
<li>insort_right</li>
</ol>
<p>Methods start with <code>bisect</code> will return the index of the element you need to insert. Those start with <code>insort</code> will make change into list directly and return nothing. The difference between <code>left</code> and <code>right</code> will affect the result of operation only when the element you want to insert does exist in the list and <code>left</code> will return the index left of this existed-element and <code>right</code> return the right position. Please remark that <code>bisect</code> is the same as <code>bisect_right</code> and <code>insort</code> is the same as <code>insort_right</code>. Let‚Äôs see some examples.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sorted_list = [<span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>]</span><br><span class="line">bisect(sorted_list, <span class="number">20</span>) <span class="comment"># return 2</span></span><br><span class="line">bisect(sorted_list, <span class="number">10</span>) <span class="comment"># return 2</span></span><br><span class="line">bisect_left(sorted_list, <span class="number">10</span>) <span class="comment"># return 1</span></span><br><span class="line">bisect_right(sorted_list, <span class="number">10</span>) <span class="comment"># return 1</span></span><br></pre></td></tr></table></figure></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/06/03/Enable-CORS-in-bottle-py/" itemprop="url">
                Enable CORS in bottle.py
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2015-06-03T10:22:27+08:00" content="2015-06-03">
            2015-06-03
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/06/03/Enable-CORS-in-bottle-py/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/06/03/Enable-CORS-in-bottle-py/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="Solution">Solution</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, run</span><br><span class="line">app = Bottle()</span><br><span class="line"> </span><br><span class="line"><span class="decorator">@app.hook('after_request')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enable_cors</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">    You need to add some headers to each request.</span><br><span class="line">    Don't use the wildcard '*' for Access-Control-Allow-Origin in production.</span><br><span class="line">    """</span></span><br><span class="line">    response.headers[<span class="string">'Access-Control-Allow-Origin'</span>] = <span class="string">'*'</span></span><br><span class="line">    response.headers[<span class="string">'Access-Control-Allow-Methods'</span>] = <span class="string">'PUT, GET, POST, DELETE, OPTIONS'</span></span><br><span class="line">    response.headers[<span class="string">'Access-Control-Allow-Headers'</span>] = <span class="string">'Origin, Accept, Content-Type, X-Requested-With, X-CSRF-Token'</span></span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/03/27/Kafka-Compression-Performance-Tests/" itemprop="url">
                Kafka Compression Performance Tests
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2015-03-27T14:01:05+08:00" content="2015-03-27">
            2015-03-27
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/03/27/Kafka-Compression-Performance-Tests/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/03/27/Kafka-Compression-Performance-Tests/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="Kafka_Compression_Performance_Tests">Kafka Compression Performance Tests</h1><h2 id="Backgroud">Backgroud</h2><p><code>Kafka</code> use <code>End-to-End</code> compression model which means that <code>Producer</code> and <code>Consumer</code> are doing the compression and de-compression jobs. This feature enables the reduction of on-the-fly network costs and the <code>Broker</code> will increase its cpu load.</p>
<h2 id="Environment">Environment</h2><h3 id="Hardware_Box">Hardware Box</h3><table>
<thead>
<tr>
<th style="text-align:right">CPU</th>
<th style="text-align:right">Memory</th>
<th style="text-align:right">Disk</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">2.5 GHz Intel Core i7</td>
<td style="text-align:right">16GB</td>
<td style="text-align:right">512GB SSD</td>
</tr>
</tbody>
</table>
<h3 id="Software_Box">Software Box</h3><table>
<thead>
<tr>
<th style="text-align:right">Kafka</th>
<th style="text-align:right">JDK</th>
<th style="text-align:right">Scala</th>
<th style="text-align:right">Broker</th>
<th style="text-align:right">Producer</th>
<th style="text-align:right">JVM</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0.8.2.1</td>
<td style="text-align:right">1.7.0u75</td>
<td style="text-align:right">2.11</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">-Xms4G -Xmx4G -Xmn2G</td>
</tr>
</tbody>
</table>
<h3 id="Kafka_Configuration">Kafka Configuration</h3><table>
<thead>
<tr>
<th style="text-align:right">Replica</th>
<th style="text-align:right">Partition</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<h3 id="Messages_Content">Messages Content</h3><p>The content I used to send to <code>Kafka</code> is a nginx log which contains 607,781 lines and 200MB. Each line is like below:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> - - [<span class="number">24</span>/Mar/<span class="number">2015</span>:<span class="number">15</span>:<span class="number">57</span>:<span class="number">09</span> +<span class="number">0800</span>] <span class="string">"GET /login?gotype=2 HTTP/1.1"</span> <span class="string">"0.002"</span> <span class="number">200</span> <span class="number">3177</span> <span class="string">"http://abc.com/URLhtml"</span> <span class="string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET4.0C; .NET4.0E)"</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> foo.com foo-hostname</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wc</span> -l passport<span class="class">.access</span><span class="class">.log</span></span><br><span class="line">  <span class="number">607781</span> passport<span class="class">.access</span><span class="class">.log</span></span><br><span class="line">~/Downloads</span><br><span class="line"><span class="variable">$du</span> -sh passport<span class="class">.access</span><span class="class">.log</span></span><br><span class="line"><span class="number">200</span>M	passport<span class="class">.access</span><span class="class">.log</span></span><br></pre></td></tr></table></figure>
<h2 id="Baseline_Test">Baseline Test</h2><h3 id="Kafka_Producer_Configuration">Kafka Producer Configuration</h3><table>
<thead>
<tr>
<th style="text-align:right">compression.type</th>
<th style="text-align:right">buffered.memory</th>
<th style="text-align:right">acks</th>
<th style="text-align:right">linger.ms</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">None</td>
<td style="text-align:right">32MB</td>
<td style="text-align:right">1</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>
<h3 id="Test_Result">Test Result</h3><p>The first test is going to figure out the fact that the value we defined in <code>batch.size</code> is not the exactly batch size <code>Producer</code> will use. I got the real batch size of <code>Producer</code> by using its metrics API. Tests have been done with <code>batch.size</code> of 200, 500, 1000, 1200, 1500, 2000. Chart below is the result: </p>
<p><img src="/images/batch_size.png" alt="Alt text"></p>
<p>We can see clearly that <code>batch.size</code> is a smaller than <code>batch-size-avg</code>(it is the excatly batch size <code>Producer</code> used). And while the <code>batch.size</code> is 200 and 500, the <code>batch-size-avg</code> is almost the same - aroud 370. That is to say, <code>batch-size-avg</code> is not only settled by the parameter <code>batch.size</code>, furthermore, it is also related to other factor.</p>
<p>All tests have been done in different <code>batch.size</code> of 500, 1000, 1200, 1500 and 2000. Why I didn‚Äôt use <code>batch.size</code> of 200 because the phenomenon in the above paragraph.</p>
<p>Let‚Äôs take a look on the <code>Producer</code> baselineÔºö</p>
<p><img src="/images/producer_baseline.png" alt="Alt text"></p>
<p>The throughput rised along with the increasing of <code>batch.size</code>. And the latency rised as well. Let me make a simple math calculation. I use the <code>batch.size</code> of 500 for the base number and get the percentage of throughput and latency increasement.</p>
<table>
<thead>
<tr>
<th style="text-align:right">-</th>
<th style="text-align:right">500</th>
<th style="text-align:right">1000</th>
<th style="text-align:right">1200</th>
<th style="text-align:right">1500</th>
<th style="text-align:right">2000</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">throughtput</td>
<td style="text-align:right">100%</td>
<td style="text-align:right">183.25%</td>
<td style="text-align:right">230.74%</td>
<td style="text-align:right">289.59%</td>
<td style="text-align:right">387.81%</td>
</tr>
<tr>
<td style="text-align:right">latency</td>
<td style="text-align:right">100%</td>
<td style="text-align:right">117.47%</td>
<td style="text-align:right">121.40%</td>
<td style="text-align:right">123.76%</td>
<td style="text-align:right">128.31%</td>
</tr>
</tbody>
</table>
<p><img src="/images/producer_baseline_ratio.png" alt="Alt text"></p>
<h3 id="Conclusion">Conclusion</h3><p>The throughtput of <code>Producer</code> can get much higher with the increasing of <code>batch.size</code>. And at the meantime, latency will increas in a very tiny level.</p>
<h2 id="Producer_Performance_with_Compression">Producer Performance with Compression</h2><p><code>Kafka</code> support three different compression typeÔºö</p>
<ul>
<li>gzip</li>
<li>snappy</li>
<li>lz4</li>
</ul>
<p>Because of the box I use to test, when I use <code>lz4</code> in testing, I got OOM exception. I think the casuse of this exception is the Java code will get all lines of the <code>passport.access.log</code> and send to <code>Kafka</code> in a very short time. So I used <code>batch.size</code> of 2000, 2500, 3000, 3500, 4000, 4500 and 5000. Using big <code>batch.size</code> will increass the latency and this will give JVM some time to do the GC jobs.</p>
<p>Below is the result</p>
<h3 id="Compression_Rate">Compression Rate</h3><p>The value is better when it is smaller</p>
<table>
<thead>
<tr>
<th style="text-align:right">-</th>
<th style="text-align:right">none</th>
<th style="text-align:right">gzip</th>
<th style="text-align:right">snappy</th>
<th style="text-align:right">lz4</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">Average Compression Rate</td>
<td style="text-align:right">100%</td>
<td style="text-align:right">19.21%</td>
<td style="text-align:right">78.19%</td>
<td style="text-align:right">31.37%</td>
</tr>
</tbody>
</table>
<p><img src="/images/compression_rate.png" alt="Alt text"></p>
<h3 id="Throughput">Throughput</h3><p>When I enabled the compression, the througput decreased. Let‚Äôs see the result.</p>
<table>
<thead>
<tr>
<th style="text-align:right">-</th>
<th style="text-align:right">none</th>
<th style="text-align:right">gzip</th>
<th style="text-align:right">snappy</th>
<th style="text-align:right">lz4</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">Average Throughtput</td>
<td style="text-align:right">151901.1038</td>
<td style="text-align:right">39346.00017</td>
<td style="text-align:right">119707.5266</td>
<td style="text-align:right">191469.8994</td>
</tr>
</tbody>
</table>
<p><img src="/images/compression_throughput.png" alt="Alt text"></p>
<h3 id="Latency">Latency</h3><p>Result:</p>
<table>
<thead>
<tr>
<th style="text-align:right">-</th>
<th style="text-align:right">none</th>
<th style="text-align:right">gzip</th>
<th style="text-align:right">snappy</th>
<th style="text-align:right">lz4</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">Average Latency ms</td>
<td style="text-align:right">0.25</td>
<td style="text-align:right">4.97</td>
<td style="text-align:right">0.41</td>
<td style="text-align:right">0.66</td>
</tr>
<tr>
<td style="text-align:right">Ratio</td>
<td style="text-align:right">100.00%</td>
<td style="text-align:right">1937.61%</td>
<td style="text-align:right">159.99%</td>
<td style="text-align:right">258.62%</td>
</tr>
</tbody>
</table>
<p><img src="/images/compression_latency.png" alt="Alt text"></p>
<h1 id="Consumer_Performance_with_Compression">Consumer Performance with Compression</h1><p>Because <code>Kafka</code> 0.8.2.1 has not enabled the new <code>Consumer</code>, so I cannot get the detailed metrics like I have got in <code>Producer</code>. So in this test, I use the total time <code>Consumer</code> used to consumes a fixed number of messages to do the benchmark.</p>
<p>The messages are <code>test.access.log</code> in twice size. Below is the result</p>
<table>
<thead>
<tr>
<th style="text-align:right">-</th>
<th style="text-align:left">none</th>
<th style="text-align:right">gzip</th>
<th style="text-align:center">snappy</th>
<th style="text-align:right">lz4</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">Time Cost ms</td>
<td style="text-align:left">3218</td>
<td style="text-align:right">5374</td>
<td style="text-align:center">5216</td>
<td style="text-align:right">4507</td>
</tr>
<tr>
<td style="text-align:right">Time Cost Increase Rate</td>
<td style="text-align:left">100%</td>
<td style="text-align:right">167%</td>
<td style="text-align:center">162.09%</td>
<td style="text-align:right">140.06%</td>
</tr>
</tbody>
</table>
<p><img src="/images/cosumer_time_cost.png" alt="Alt text"></p>
<p>We can see <code>lz4</code> is the fastest.</p>
<h1 id="Conclusion-1">Conclusion</h1><p><code>lz4</code> is the best choice in compression rate and both performance of <code>Producer</code> and <code>Consumer</code>. Below is the comparison of <code>lz4</code> performance and base line performance. For simplified the chart, this only shows the result with <code>batch.size</code> of 5000.</p>
<p><img src="/images/overview.png" alt="Alt text"></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/03/04/The-Analysis-of-Zabbix-history-and-trends-Storing/" itemprop="url">
                The Analysis of Zabbix history and trends Storing
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2015-03-04T09:41:25+08:00" content="2015-03-04">
            2015-03-04
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/03/04/The-Analysis-of-Zabbix-history-and-trends-Storing/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/03/04/The-Analysis-of-Zabbix-history-and-trends-Storing/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="Intro">Intro</h1><p><code>history</code> and <code>trends</code> are two main tables in Zabbix database for storing data. There are also tables inherits <code>history</code> which are used to store different types of data. For example, table <code>history_uint</code> is to store uint data. Others are <code>history_str</code>, <code>history_log</code> and <code>history_text</code>. Please pay attention that there is only one table inherits table <code>trends</code> and its name is <code>table_uint</code>.</p>
<h1 id="Entrance">Entrance</h1><p>The start of the whole process is in function <code>DCsync_all()</code>, <code>src/libs/zbxdbcache/dbcache.c</code>. <code>dbcache</code> is a feature which enables Zabbix to keep data in memory first and flush to database in batch.</p>
<p>To make it more clearly, I wrote comments inline.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>	<span class="title">DCsync_all</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	zabbix_log(LOG_LEVEL_DEBUG, <span class="string">"In DCsync_all()"</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// call `DCsync_history` to sync history data from cache to database</span></span><br><span class="line">	DCsync_history(ZBX_SYNC_FULL);</span><br><span class="line">	<span class="comment">// assert code is running in Zabbix Server. Zabbix Server WILL NOT run codes below</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="number">0</span> != (daemon_type &amp; ZBX_DAEMON_TYPE_SERVER))</span><br><span class="line">		<span class="comment">// sync trends data. </span></span><br><span class="line">		DCsync_trends();</span><br><span class="line">	zabbix_log(LOG_LEVEL_DEBUG, <span class="string">"End of DCsync_all()"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="DCsync_history()">DCsync_history()</h1><p>Since we are talking about Zabbix Server, so we will only take a look at <code>DCsync_history()</code>. In this paragraph, I have simplified the code in <code>DCsync_history()</code> to help readers understand the core process of flushing data to database.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DBbegin();</span><br><span class="line">	</span><br><span class="line"><span class="comment">// while in Zabbix Server mode</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> != (daemon_type &amp; ZBX_DAEMON_TYPE_SERVER))</span><br><span class="line">&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">// add data to history</span></span><br><span class="line">	DCmass_add_history(history, history_num);</span><br><span class="line">	<span class="comment">// update trends</span></span><br><span class="line">	DCmass_update_trends(history, history_num);</span><br><span class="line">	...		</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	DCmass_proxy_add_history(history, history_num);</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">DBcommit();</span><br></pre></td></tr></table></figure>
<h1 id="DCmass_add_history()">DCmass_add_history()</h1><p>Let‚Äôs take a look into <code>DCmass_add_history()</code>.</p>
<p>It will calculate the numbers for each type of items.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (history[i].value_type)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> ITEM_VALUE_TYPE_FLOAT:</span><br><span class="line">			h_num++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> ITEM_VALUE_TYPE_UINT64:</span><br><span class="line">			huint_num++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> ITEM_VALUE_TYPE_STR:</span><br><span class="line">			hstr_num++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> ITEM_VALUE_TYPE_TEXT:</span><br><span class="line">			htext_num++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> ITEM_VALUE_TYPE_LOG:</span><br><span class="line">			hlog_num++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And then, call function to write data to database.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* history */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> != h_num)</span><br><span class="line">	dc_add_history_dbl(history, history_num);</span><br><span class="line"><span class="comment">/* history_uint */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> != huint_num)</span><br><span class="line">	dc_add_history_uint(history, history_num);</span><br></pre></td></tr></table></figure>
<p>Finally, we can touch the sql in <code>dc_add_history_dbl()</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>	<span class="title">dc_add_history_dbl</span><span class="params">(ZBX_DC_HISTORY *history, <span class="keyword">int</span> history_num)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; history_num; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		...</span><br><span class="line">		zbx_db_insert_add_values(&amp;db_insert, history[i].itemid, history[i].ts.sec, history[i].ts.ns,</span><br><span class="line">				history[i].value.dbl);</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="DCmass_update_trends">DCmass_update_trends</h1><p>Let‚Äôs see the code first.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>	<span class="title">DCmass_update_trends</span><span class="params">(ZBX_DC_HISTORY *history, <span class="keyword">int</span> history_num)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; history_num; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		...</span><br><span class="line">		DCadd_trend(&amp;history[i], &amp;trends, &amp;trends_alloc, &amp;trends_num);</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">0</span> &lt; trends_num)</span><br><span class="line">		<span class="comment">// flush trends while we actually HAVE trends data to flush</span></span><br><span class="line">		DCflush_trends(trends, &amp;trends_num, <span class="number">1</span>);</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We get that the main process is in the function <code>DCadd_trend()</code>. Let‚Äôs move on to it.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span>	<span class="title">DCadd_trend</span><span class="params">(ZBX_DC_HISTORY *history, ZBX_DC_TREND **trends, <span class="keyword">int</span> *trends_alloc, <span class="keyword">int</span> *trends_num)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">// get trend data from database by itemid</span></span><br><span class="line">	trend = DCget_trend(history-&gt;itemid);</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">switch</span> (trend-&gt;value_type)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> ITEM_VALUE_TYPE_FLOAT:</span><br><span class="line">			...</span><br><span class="line">			<span class="comment">// calculate the new data</span></span><br><span class="line">			trend-&gt;value_avg.dbl = (trend-&gt;num * trend-&gt;value_avg.dbl</span><br><span class="line">				+ history-&gt;value.dbl) / (trend-&gt;num + <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Above all, I think we are clear on the fact how Zabbix update history and trends.</p>
<p>Below is the process:<br><img src="/images/zabbix_history_trends.jpg" alt="Alt text"></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/02/27/Zabbix-install-issue-with-aclocal-1-14-is-missing/" itemprop="url">
                Zabbix install issues with aclocal 1.14 is missing
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2015-02-27T07:14:35+08:00" content="2015-02-27">
            2015-02-27
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/02/27/Zabbix-install-issue-with-aclocal-1-14-is-missing/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/02/27/Zabbix-install-issue-with-aclocal-1-14-is-missing/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="Backgroud">Backgroud</h1><p><code>configure</code> is okay, the next step is <code>make install</code>. But <code>make install</code> exist with error which said it cannot find <code>aclocal-1.14</code> like below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[baniuyao@YaoRenjies-CentOS zabbix-<span class="number">2.4</span>.<span class="number">4</span>]$ sudo make install</span><br><span class="line">CDPATH=<span class="string">"<span class="variable">$&#123;ZSH_VERSION+.&#125;</span>:"</span> &amp;&amp; <span class="built_in">cd</span> . &amp;&amp; /bin/sh /home/baniuyao/apps/zabbix-<span class="number">2.4</span>.<span class="number">4</span>/missing aclocal-<span class="number">1.14</span> -I m4</span><br><span class="line">/home/baniuyao/apps/zabbix-<span class="number">2.4</span>.<span class="number">4</span>/missing: line <span class="number">81</span>: aclocal-<span class="number">1.14</span>: <span class="built_in">command</span> not found</span><br><span class="line">WARNING: <span class="string">'aclocal-1.14'</span> is missing on your system.</span><br><span class="line">         You should only need it <span class="keyword">if</span> you modified <span class="string">'acinclude.m4'</span> or</span><br><span class="line">         <span class="string">'configure.ac'</span> or m4 files included by <span class="string">'configure.ac'</span>.</span><br><span class="line">         The <span class="string">'aclocal'</span> program is part of the GNU Automake package:</span><br><span class="line">         &lt;http://www.gnu.org/software/automake&gt;</span><br><span class="line">         It also requires GNU Autoconf, GNU m4 and Perl <span class="keyword">in</span> order to run:</span><br><span class="line">         &lt;http://www.gnu.org/software/autoconf&gt;</span><br><span class="line">         &lt;http://www.gnu.org/software/m4/&gt;</span><br><span class="line">         &lt;http://www.perl.org/&gt;</span><br><span class="line">make: *** [aclocal.m4] Error <span class="number">127</span></span><br></pre></td></tr></table></figure>
<p>But the system has <code>aclocal-1.14</code> already:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[baniuyao@YaoRenjies-CentOS ~]$ <span class="built_in">which</span> aclocal-<span class="number">1.14</span></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/aclocal-<span class="number">1.14</span></span><br></pre></td></tr></table></figure>
<h1 id="Solution">Solution</h1><p>This is because we don‚Äôt have some <code>autoconf</code>(<em>.ac) and <code>automake</code>(</em>.am) files. We can <code>touch</code> these.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch configure.ac aclocal.m4 configure Makefile.am Makefile.in</span><br></pre></td></tr></table></figure>
<p>Or we can use <code>autoreconf</code> to generate.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo autoreconf -ivf</span><br></pre></td></tr></table></figure>
<p>Let‚Äôs figure out what <code>-ivf</code> means.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-v, --verbose            verbosely report processing</span><br><span class="line"><span class="operator">-f</span>, --force              consider all files obsolete</span><br><span class="line">-i, --install            copy missing auxiliary files</span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&laquo;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">&raquo;</a>
  </nav>

 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar-hippo.jpg" alt="Renjie Yao" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Renjie Yao</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">21</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">categories</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">39</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/baniuyao" target="_blank">github</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/frankymryao" target="_blank">weibo</a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Renjie Yao</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'renjieyaoblog';
      var disqus_identifier = 'page/2/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
